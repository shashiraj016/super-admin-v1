<div class="mt-4">
    <ng-container [ngSwitch]="selectedTab">
        <div *ngSwitchCase="'dashboard'">
            <router-outlet></router-outlet>
        </div>
        <div *ngSwitchCase="'summary'">
            <div class="mt-4">

                <!-- sa-summary-dashboard.component.html -->
                <div class="sa-dashboard-container">

                    <!-- Filters -->
                    <div class="filters-wrap">
                        <section class="filters">
                            <h2>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                                </svg>
                                Filters
                            </h2>

                            <!-- ðŸ”¹ Filter Dropdown -->
                            <div class="select">
                                <!-- Icon -->
                                <!-- <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                                </svg> -->

                                <!-- Filter Dropdown -->
                                <select [(ngModel)]="selectedFilter" (change)="onFilterChange(selectedFilter)">
                                    <!-- <option value="all">All</option> -->
                                    <option value="DAY">Today</option>
                                    <option value="YESTERDAY">Yesterday</option>
                                    <option value="WEEK">This Week</option>
                                    <option value="LAST_WEEK">Last Week</option>
                                    <option value="MTD">This Month</option>
                                    <option value="LAST_MONTH">Last Month</option>
                                    <option value="QTD">This Quarter</option>
                                    <option value="LAST_QUARTER">Last Quarter</option>
                                    <!-- <option value="SIX_MONTH">Last 6 Months</option> -->
                                    <!-- <option value="YTD">This Year</option>
                                    <option value="LIFETIME">Lifetime</option>
                                    <option value="CUSTOM">Custom</option> -->
                                </select>
                            </div>



                            <!-- <div class="select-dropdown" #dropdown (click)="toggleDropdown()"
                                [class.open]="dropdownOpen">
                                <div class="dropdown-label">
                                    {{ selectedDealers.length ? selectedDealers.length + ' selected' : 'Select Dealers'
                                    }}
                                </div>

                                <div class="dropdown-menu">
                                    <div *ngFor="let dealer of allDealers" class="checkbox-item"
                                        (click)="$event.stopPropagation()">
                                        <input type="checkbox" [id]="dealer.dealer_id"
                                            [checked]="selectedDealers.includes(dealer.dealer_id)"
                                            (change)="onDealerChange(dealer.dealer_id, $event)" />
                                        <label [for]="dealer.dealer_id">{{ dealer.dealer_name }}</label>
                                    </div>
                                </div>
                            </div> -->
                            <div class="select-dropdown" #dropdown (click)="toggleDropdown()"
                                [class.open]="dropdownOpen">
                                <div class="dropdown-label">
                                    {{
                                    selectedDealers.length === allDealers.length
                                    ? 'All Dealers Selected'
                                    : (selectedDealers.length ? selectedDealers.length + ' selected' : 'Select Dealers')
                                    }}
                                </div>

                                <div class="dropdown-menu">
                                    <!-- ðŸ”¹ Select All / Clear -->
                                    <div class="actions-row">
                                        <button type="button"
                                            (click)="selectAllDealers($event); $event.stopPropagation()">Select
                                            All</button>
                                        <button type="button"
                                            (click)="clearDealers($event); $event.stopPropagation()">Clear</button>
                                    </div>

                                    <!-- ðŸ”¹ Search Box -->
                                    <div class="search-row" (click)="$event.stopPropagation()">
                                        <input type="text" placeholder="Search Dealers" [(ngModel)]="dealerSearch" />
                                    </div>

                                    <!-- ðŸ”¹ Dealer List or No Dealers Found -->
                                    <ng-container *ngIf="filteredDealers().length > 0; else noDealers">
                                        <ng-container *ngFor="let dealer of filteredDealers()">
                                            <div class="checkbox-item"
                                                *ngIf="dealer.dealer_name && dealer.dealer_name.trim() !== ''"
                                                (click)="$event.stopPropagation()">

                                                <input type="checkbox" [id]="dealer.dealer_id"
                                                    [checked]="selectedDealers.includes(dealer.dealer_id)"
                                                    (change)="onDealerChange(dealer.dealer_id, $event)" />
                                                <label [for]="dealer.dealer_id">{{ dealer.dealer_name }}</label>
                                            </div>
                                        </ng-container>
                                    </ng-container>

                                    <ng-template #noDealers>
                                        <div class="no-dealers">
                                            No Dealers Found
                                        </div>
                                    </ng-template>
                                </div>
                            </div>


                            <div class="select-dropdown" #psDropdown (click)="togglePSDropdown()"
                                [class.open]="dropdownPSOpen">
                                <!-- <div class="dropdown-label">
                                    {{
                                    selectedPSs.length === users.length
                                    ? 'All PS Selected'
                                    : (selectedPSs.length ? selectedPSs.length + ' selected' : 'Select PS')
                                    }}
                                </div> -->
                                <div class="dropdown-label">
                                    {{
                                    selectedPSs.length === filteredPSs().length
                                    ? 'All PS Selected'
                                    : (selectedPSs.length ? selectedPSs.length + ' selected' : 'Select PS')
                                    }}
                                </div>

                                <div class="dropdown-menu" (click)="$event.stopPropagation()">
                                    <!-- ðŸ”¹ Select All / Clear -->
                                    <div class="actions-row">
                                        <button type="button"
                                            (click)="toggleSelectAllPS($event); $event.stopPropagation()">Select
                                            All</button>
                                        <button type="button"
                                            (click)="clearAllPS($event); $event.stopPropagation()">Clear</button>
                                    </div>

                                    <!-- ðŸ”¹ Search Box -->
                                    <div class="search-row" (click)="$event.stopPropagation()">
                                        <input type="text" placeholder="Search PS" [(ngModel)]="psSearch" />
                                    </div>

                                    <!-- ðŸ”¹ PS List or No PS Found -->
                                    <!-- ðŸ”¹ PS List or No PS Found -->
                                    <ng-container *ngIf="filteredPSs().length > 0; else noPS">
                                        <ng-container *ngFor="let ps of filteredPSs()">
                                            <div class="checkbox-item" *ngIf="ps.name && ps.name.trim() !== ''"
                                                (click)="$event.stopPropagation()">

                                                <input type="checkbox" [id]="ps.user_id"
                                                    [checked]="selectedPSs.includes(ps.user_id)"
                                                    (change)="onPSChange(ps.user_id, $event)" />
                                                <label [for]="ps.user_id">{{ ps.name }}</label>
                                            </div>
                                        </ng-container>
                                    </ng-container>

                                    <ng-template #noPS>
                                        <div class="no-dealers">
                                            No PS Found
                                        </div>
                                    </ng-template>
                                </div>
                            </div>



                            <!-- <div class="select-dropdown" #modelDropdown (click)="toggleModelDropdown()"
                                [class.open]="modelDropdownOpen">
                                <div class="dropdown-label">
                                    {{ selectedModels.length ? selectedModels.length + ' selected' : 'Select Models' }}
                                </div>

                                <div class="dropdown-menu" (click)="$event.stopPropagation()">
                                    
                                    <div *ngFor="let model of models; let i = index" class="checkbox-item">
                                        <input type="checkbox" [id]="'model-' + i" [checked]="model.selected"
                                            (change)="onModelChange(model.model)" />
                                        <label [for]="'model-' + i">{{ model.model_name }}</label>
                                    </div>
                                </div>
                            </div> -->
                            <div class="select-dropdown" #modelDropdown (click)="toggleModelDropdown()"
                                [class.open]="modelDropdownOpen">

                                <div class="dropdown-label">
                                    {{ selectedModels.length === models.length
                                    ? 'All Models Selected'
                                    : (selectedModels.length ? selectedModels.length + ' selected' : 'Select Model') }}
                                </div>

                                <div class="dropdown-menu" (click)="$event.stopPropagation()">
                                    <!-- ðŸ”¹ Select All / Clear -->
                                    <div class="actions-row">
                                        <button type="button"
                                            (click)="selectAllModels($event); $event.stopPropagation()">Select
                                            All</button>
                                        <button type="button"
                                            (click)="clearModels($event); $event.stopPropagation()">Clear</button>
                                    </div>

                                    <!-- ðŸ”¹ Search Box -->
                                    <div class="search-row" (click)="$event.stopPropagation()">
                                        <input type="text" placeholder="Search Models" [(ngModel)]="modelSearch" />
                                    </div>

                                    <!-- ðŸ”¹ Model List or No Models Found -->
                                    <!-- <ng-container *ngIf="filteredModels().length > 0; else noModels">
                                        <div *ngFor="let model of filteredModels(); let i = index" class="checkbox-item"
                                            (click)="$event.stopPropagation()">
                                            <input type="checkbox" [id]="'model-' + i" [checked]="model.selected"
                                                (change)="onModelChange(model.model)" />
                                            <label [for]="'model-' + i">{{ model.model_name }}</label>
                                        </div>
                                    </ng-container> -->
                                    <ng-container *ngIf="filteredModels().length > 0; else noModels">
                                        <ng-container *ngFor="let model of filteredModels(); let i = index">
                                            <div class="checkbox-item" (click)="$event.stopPropagation()"
                                                *ngIf="model.model_name && model.model_name.trim() !== ''">

                                                <input type="checkbox" [id]="'model-' + i" [checked]="model.selected"
                                                    (change)="onModelChange(model.model)" />
                                                <label [for]="'model-' + i">{{ model.model_name }}</label>
                                            </div>
                                        </ng-container>
                                    </ng-container>
                                    <ng-template #noModels>
                                        <div class="no-dealers">No Models Found</div>
                                    </ng-template>
                                </div>
                            </div>

                            <div class="filter-actions">
                                <button type="button" class="btn" (click)="resetFilters()">Reset</button>
                            </div>
                        </section>
                    </div>

                    <section class="kpi-grid">
                        <!-- Efforts Card -->
                        <div class="kpi-card">
                            <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
                                <!-- Card title next to count -->
                                <h3 style="margin: 0; display: flex; align-items: center; gap: 6px;margin-left:-10px;">
                                    Efforts
                                    <!-- <span class="count"
                                        [ngStyle]="{ 'color': getKpiColor(categoryPercentages.Efforts || 0) }"
                                        style="font-weight: bold;">
                                        {{ categoryPercentages.Efforts || 0 }}%
                                    </span> -->
                                </h3>

                                <!-- Chip stays at the end -->
                                <!-- <span class="chip" id="chipdiv"
                                    style="border:1px solid #ccc; background: #f1f5ff; margin-left:auto; display: flex; align-items: center; gap: 4px;">
                                    <span class="dot"></span>
                                    overall
                                </span> -->
                                <span class="chip" id="chipdiv"
                                    style="border:1px solid #ccc; background: #f1f5ff; margin-left:auto; display: flex; align-items: center; gap: 4px;">
                                    <span class="dot"></span>
                                    <span class="count"
                                        [ngStyle]="{ 'color': getKpiColor(categoryPercentages.Efforts || 0) }"
                                        style="font-weight: bold;">
                                        {{ categoryPercentages.Efforts || 0 }}%
                                    </span>
                                    overall

                                </span>
                            </div>

                            <div class="kpi-items">
                                <div class="kpi-item-wrapper" *ngFor="let kpi of efforts">
                                    <div class="kpi-item">
                                        <div class="kpi-row">
                                            <span class="kpi-label">{{ kpi.name }}</span>
                                            <div class="kpi-values">
                                                <span class="kpi-actual">{{ kpi.value }} | {{ kpi.achieved }}%</span>
                                                <!-- <svg class="trend-icon"
                                                    [ngClass]="kpi.growth >= 0 ? 'trend-up' : 'trend-down'"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        [attr.d]="kpi.growth >= 0 ? 'M5 12l5-5 9 9' : 'M19 12l-5 5-9-9'" />
                                                </svg> -->
                                                <div class="trend-icon"
                                                    [ngClass]="kpi.growth >= 0 ? 'arrow-up' : 'arrow-down'"></div>


                                            </div>
                                        </div>


                                        <!-- <div class="progress">
                                            <div class="bar" [style.width.%]="kpi.achieved"
                                                [ngStyle]="{'background-color': getProgressColor(kpi.achieved)}">
                                            </div>
                                        </div> -->
                                        <div class="chart-container">
                                            <div class="progress-wrapper">
                                                <div class="progress"
                                                    [attr.title]="'Actual: ' + kpi.value + ', Target: ' + kpi.target"
                                                    (click)="showTooltip($event, kpi)">
                                                    <div class="bar"
                                                        [style.width.%]="getProgressWidth(kpi.value, kpi.target)"
                                                        [ngStyle]="{ 'background-color': getProgressColor(kpi.value, kpi.target) }">
                                                    </div>
                                                </div>

                                                <!-- Target marker -->
                                                <div class="target-marker-global" *ngIf="kpi.target !== 0"
                                                    [style.left.%]="getTargetPosition(kpi.value, kpi.target)">
                                                </div>
                                            </div>



                                        </div>
                                    </div>

                                    <div class="growth-box" [class.positive-box]="kpi.growth > 0"
                                        [class.negative-box]="kpi.growth < 0">
                                        <div class="growth-title">GROWTH</div>
                                        <div class="growth-value">
                                            {{ kpi.growth > 0 ? '+' + kpi.growth : kpi.growth }}%
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>




                        <div class="kpi-card">
                            <div class="card-header" style="display: flex; align-items: center; gap: 8px;">
                                <h3 style="margin: 0; display: flex; align-items: center; gap: 6px;margin-left:-10px">
                                    Productivity

                                </h3>



                                <span class="chip" id="chipdiv"
                                    style="border:1px solid #ccc; background: #f1f5ff; margin-left:auto; display: flex; align-items: center; gap: 4px;">
                                    <span class="dot"></span>
                                    <span class="count"
                                        [ngStyle]="{ 'color': getKpiColor(categoryPercentages.Productivity || 0) }"
                                        style="font-weight: bold;">
                                        {{ categoryPercentages.Productivity || 0 }}%
                                    </span>
                                    overall

                                </span>
                            </div>

                            <div class="kpi-items">
                                <div class="kpi-item-wrapper" *ngFor="let kpi of productivity">
                                    <div class="kpi-item">
                                        <div class="kpi-row">
                                            <span class="kpi-label">{{ kpi.name }}</span>
                                            <div class="kpi-values">
                                                <span class="kpi-actual">{{ kpi.value }} | {{ kpi.achieved }}%</span>
                                                <!-- <svg class="trend-icon"
                                                    [ngClass]="kpi.growth >= 0 ? 'trend-up' : 'trend-down'"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        [attr.d]="kpi.growth >= 0 ? 'M5 12l5-5 9 9' : 'M19 12l-5 5-9-9'" />
                                                </svg> -->
                                                <div class="trend-icon"
                                                    [ngClass]="kpi.growth >= 0 ? 'arrow-up' : 'arrow-down'"></div>

                                            </div>
                                        </div>


                                        <!-- <div class="progress">
                                            <div class="bar" [style.width.%]="kpi.achieved"
                                                [ngStyle]="{'background-color': getProgressColor(kpi.achieved)}">
                                            </div>
                                        </div> -->
                                        <div class="chart-container">
                                            <div class="progress-wrapper">
                                                <div class="progress"
                                                    [attr.title]="'Actual: ' + kpi.value + ', Target: ' + kpi.target"
                                                    (click)="showTooltip($event, kpi)">
                                                    <div class="bar"
                                                        [style.width.%]="getProgressWidth(kpi.value, kpi.target)"
                                                        [ngStyle]="{ 'background-color': getProgressColor(kpi.value, kpi.target) }">
                                                    </div>
                                                </div>

                                                <!-- Target marker positioned correctly -->
                                                <div class="target-marker-global" *ngIf="kpi.target !== 0"
                                                    [style.left.%]="getTargetPosition(kpi.value, kpi.target)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="growth-box" [class.positive-box]="kpi.growth > 0"
                                        [class.negative-box]="kpi.growth < 0">
                                        <div class="growth-title">GROWTH</div>
                                        <div class="growth-value">
                                            {{ kpi.growth > 0 ? '+' + kpi.growth : kpi.growth }}%
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>



                        <!-- Active PS Card -->
                        <div class="kpi-card">
                            <div class="card-header">
                                <h3>Active PS</h3>
                                <!-- <span class="chip"><span class="dot"></span> Live</span> -->
                            </div>

                            <div class="kpi-items">
                                <div class="kpi-item-wrapper" *ngFor="let kpi of activePSKpis">
                                    <div class="kpi-item">
                                        <div class="kpi-row">
                                            <span class="kpi-label">{{ kpi.name }}</span>
                                            <div class="kpi-values">
                                                <span class="kpi-actual">{{ kpi.value }} | {{ kpi.achieved
                                                    }}%</span>
                                                <!-- <svg class="trend-icon"
                                                    [ngClass]="kpi.growth >= 0 ? 'trend-up' : 'trend-down'"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        [attr.d]="kpi.growth >= 0 ? 'M5 12l5-5 9 9' : 'M19 12l-5 5-9-9'" />
                                                </svg> -->
                                                <div class="trend-icon"
                                                    [ngClass]="kpi.growth >= 0 ? 'arrow-up' : 'arrow-down'"></div>

                                            </div>
                                        </div>


                                        <!-- <div class="progress">
                                            <div class="bar" [style.width.%]="kpi.achieved"
                                                [ngStyle]="{'background-color': getProgressColor(kpi.achieved)}">
                                            </div>
                                        </div> -->
                                        <div class="chart-container">
                                            <div class="progress-wrapper">
                                                <div class="progress"
                                                    [attr.title]="'Actual: ' + kpi.value + ', Target: ' + kpi.target"
                                                    (click)="showTooltip($event, kpi)">
                                                    <div class="bar"
                                                        [style.width.%]="getProgressWidth(kpi.value, kpi.target)"
                                                        [ngStyle]="{ 'background-color': getProgressColor(kpi.value, kpi.target) }">
                                                    </div>
                                                </div>

                                                <!-- Target marker positioned correctly -->
                                                <div class="target-marker-global" *ngIf="kpi.target !== 0"
                                                    [style.left.%]="getTargetPosition(kpi.value, kpi.target)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Growth Box -->
                                    <div class="growth-box" [class.positive-box]="kpi.growth > 0"
                                        [class.negative-box]="kpi.growth < 0">
                                        <div class="growth-title">GROWTH</div>
                                        <div class="growth-value">
                                            {{ kpi.growth > 0 ? '+' + kpi.growth : kpi.growth }}%
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Other KPIs Card -->
                        <!-- Other KPIs Card -->
                        <div class="kpi-card">
                            <div class="card-header" style="display: flex; align-items: center; gap: 8px;">
                                <!-- Card title with count next to it -->
                                <h3 style="margin: 0; display: flex; align-items: center; gap: 6px;margin-left:-10px;">
                                    Other KPIs
                                    <!-- <span class="count"
                                        [ngStyle]="{ 'color': getKpiColor(categoryPercentages['Other KPIs'] || 0) }"
                                        style="font-weight: bold;">
                                        {{ categoryPercentages['Other KPIs'] || 0 }}%
                                    </span> -->
                                </h3>
                                <!-- IF BACKEND COMES THEN GETKPICOLOR(OTHERKPICOUNT) -->

                                <!-- Chip aligned to the right -->
                                <!-- <span class="chip"
                                    style="margin-left:auto; border:1px solid #ccc; background: #f1f5ff; display: flex; align-items: center; gap: 4px;">
                                    <span class="dot"></span>
                                    target
                                </span> -->
                                <span class="chip" id="chipdiv"
                                    style="border:1px solid #ccc; background: #f1f5ff; margin-left:auto; display: flex; align-items: center; gap: 4px;">
                                    <span class="dot"></span>
                                    <span class="count"
                                        [ngStyle]="{ 'color': getKpiColor(categoryPercentages['Other KPIs'] || 0) }"
                                        style="font-weight: bold;">
                                        {{ categoryPercentages['Other KPIs'] || 0 }}%
                                    </span>
                                    target
                                </span>
                            </div>

                            <div class="kpi-items">
                                <div class="kpi-item-wrapper" *ngFor="let kpi of otherKpis">
                                    <div class="kpi-item">
                                        <div class="kpi-row">
                                            <span class="kpi-label">{{ kpi.name }}</span>
                                            <div class="kpi-values">
                                                <span class="kpi-actual">{{ kpi.value }} | {{ kpi.target }}%</span>
                                                <!-- <svg class="trend-icon"
                                                    [ngClass]="kpi.growth >= 0 ? 'trend-up' : 'trend-down'"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        [attr.d]="kpi.growth >= 0 ? 'M5 12l5-5 9 9' : 'M19 12l-5 5-9-9'" />
                                                </svg> -->
                                                <div class="trend-icon"
                                                    [ngClass]="kpi.growth >= 0 ? 'arrow-up' : 'arrow-down'"></div>

                                            </div>
                                        </div>

                                        <!-- <div class="progress">
                                            <div class="bar" [style.width.%]="kpi.progress"></div>
                                        </div> -->
                                        <!-- <div class="progress">
                                            <div class="bar" [style.width.%]="kpi.achieved"
                                                [ngStyle]="{'background-color': getProgressColor(kpi.achieved)}">
                                            </div>
                                        </div> -->
                                        <div class="chart-container">
                                            <div class="progress-wrapper">
                                                <div class="progress"
                                                    [attr.title]="'Actual: ' + kpi.value + ', Target: ' + kpi.target"
                                                    (click)="showTooltip($event, kpi)">
                                                    <div class="bar"
                                                        [style.width.%]="getProgressWidth(kpi.value, kpi.target)"
                                                        [ngStyle]="{ 'background-color': getProgressColor(kpi.value, kpi.target) }">
                                                    </div>
                                                </div>

                                                <!-- Target marker positioned correctly -->
                                                <div class="target-marker-global" *ngIf="kpi.target !== 0"
                                                    [style.left.%]="getTargetPosition(kpi.value, kpi.target)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Growth Box -->
                                    <div class="growth-box" [class.positive-box]="kpi.growth > 0"
                                        [class.negative-box]="kpi.growth < 0">
                                        <div class="growth-title">GROWTH</div>
                                        <div class="growth-value">
                                            {{ kpi.growth > 0 ? '+' + kpi.growth : kpi.growth }}%
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Remove total bar at the bottom -->
                            <!-- <div class="total-bar">Total: 90</div> -->
                        </div>

                        <!-- Tooltip container (only for iOS tap) -->
                        <div *ngIf="tooltipText" class="custom-tooltip" [style.top.px]="tooltipY"
                            [style.left.px]="tooltipX">
                            {{ tooltipText }}
                        </div>



                    </section>
                </div>
            </div>
        </div>
    </ng-container>
</div>